{"ast":null,"code":"var _jsxFileName = \"/Users/tyler/Documents/Programming/ReactApps/scheduler-app-database/client/src/components/homePage/generateScheduleButton/GenerateScheduleButton.js\",\n    _s = $RefreshSig$();\n\nimport { Button, Typography, Grid } from \"@material-ui/core\";\nimport { useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { editEmployee, getEmployees } from '../../../actions/employees';\nimport weekShifts from '../../../testData/weekShifts';\nimport theme from '../../../themes/mintTheme';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst GenerateScheduleButton = ({\n  setPage\n}) => {\n  _s();\n\n  let shifts = weekShifts;\n  const dispatch = useDispatch();\n  const employees = useSelector(state => state.employees);\n  let scheduledEmployees = [];\n  let excessShifts = [];\n  const [employee, setEmployee] = useState(null);\n  const [schedule, setSchedule] = useState(null);\n  const [scheduleStack, setScheduleStack] = useState([]);\n  const [currentId, setCurrentId] = useState(null);\n  const NOON = 12;\n\n  const randomizeShifts = array => {\n    let shuffledArray = [];\n    let shift = null;\n\n    for (let i = array.length - 1; i >= 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [array[i], array[j]] = [array[j], array[i]];\n      shift = array[i];\n\n      for (let x = shift.length - 1; x >= 0; x--) {\n        const y = Math.floor(Math.random() * (x + 1));\n        [array[i][x], array[i][y]] = [array[i][y], array[i][x]];\n        shift = array[i][x];\n        shuffledArray.push(shift);\n      }\n    }\n\n    return shuffledArray;\n  };\n\n  const randomizeEmployees = array => {\n    for (let i = array.length - 1; i >= 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [array[i], array[j]] = [array[j], array[i]];\n    }\n  };\n\n  const createSchedule = shifts => {\n    let i = 0;\n    let dayOff = [];\n    scheduledEmployees = [];\n    excessShifts = [];\n    let blankEmployees = eraseSchedules(employees);\n    randomizeEmployees(blankEmployees);\n    blankEmployees.forEach(employee => {\n      let randomDay = Math.floor(Math.random() * 7);\n      dayOff.push(randomDay);\n    });\n\n    while (shifts.length > 0) {\n      let randomShift = Math.floor(Math.random() * shifts.length);\n      let shift = shifts[randomShift];\n      let currentEmployee = blankEmployees[i];\n      let currentDayOff = dayOff[i];\n      let currentEmployeeId = currentEmployee._id;\n      const isEmployeeAvailable = canEmployeeTakeShift(currentEmployee, shift, currentDayOff);\n\n      if (isEmployeeAvailable && (currentEmployee.numHours <= currentEmployee.desiredHours.replace(/\\D/g, \"\").slice(-2) || currentEmployee.desiredHours.replace(/\\D/g, \"\").slice(-2) >= 40)) {\n        currentEmployee.weekSchedule.push(shift);\n        calculateNumHours(currentEmployee, shift);\n        shifts.splice(randomShift, 1);\n\n        if (!scheduledEmployees.some(employee => employee._id === currentEmployeeId)) {\n          scheduledEmployees.push(currentEmployee);\n        }\n      } else {\n        if (i < blankEmployees.length - 1) {\n          i++;\n        } else {\n          i = 0;\n          excessShifts.push(shift);\n          shifts.splice(randomShift, 1);\n        }\n      }\n    }\n  };\n\n  const canEmployeeTakeShift = (employee, shift, currentDayOff) => {\n    const date = new Date(shift.startDate);\n    const dayOfWeek = date.getDay();\n    const shiftStartTime = convertTimeToNumber(shift.startDate.split(' ')[4]);\n    const day = shift.startDate.split(' ')[0];\n    const availabilityDay = dayOfWeek === 0 ? 6 : dayOfWeek - 1;\n    const isAvailableMorning = employee.availability[availabilityDay].morning;\n    const isAvailableEvening = employee.availability[availabilityDay].evening;\n    const isMorningShift = shiftStartTime < NOON ? true : false;\n    const isAlreadyWorking = checkIfWorking(employee, day, isMorningShift);\n    const isTrained = checkIfTrained(employee, shift);\n    return isAlreadyWorking ? false : !isTrained ? false : dayOfWeek == currentDayOff ? false : isMorningShift && isAvailableMorning ? true : !isMorningShift && isAvailableEvening ? true : false;\n  };\n\n  const checkIfWorking = (employee, day, isMorningShift) => {\n    let numShiftsInDay = 0;\n    employee.weekSchedule.forEach(shift => {\n      if (shift.startDate.includes(day)) {\n        numShiftsInDay++;\n      }\n    });\n    if (numShiftsInDay > 1) return true;\n    const employeeShift = employee.weekSchedule.find(shift => shift.startDate.includes(day));\n\n    if (employeeShift) {\n      const employeeShiftTime = convertTimeToNumber(employeeShift.startDate.split(' ')[4]);\n      if (isMorningShift && employeeShiftTime < NOON) return true;\n      if (isMorningShift && employeeShiftTime > NOON) return false;\n      if (!isMorningShift && employeeShiftTime > NOON) return true;\n      if (!isMorningShift && employeeShiftTime > NOON) return false;\n    }\n\n    return false;\n  };\n\n  const calculateNumHours = (employee, shift) => {\n    let startTime = convertTimeToNumber(shift.startDate.split(' ')[4]);\n    let endTime = convertTimeToNumber(shift.endDate.split(' ')[4]);\n    let shiftHours = endTime - startTime;\n    employee.numHours += shiftHours;\n  };\n\n  const checkIfTrained = (employee, shift) => {\n    const position = shift.title;\n    let isTrained = false;\n    employee.positions.forEach(pos => {\n      if (position.trim() === pos.trim()) {\n        isTrained = true;\n      }\n    });\n    return isTrained;\n  };\n\n  const convertTimeToNumber = time => {\n    var hoursMinutes = time.split(/[.:]/);\n    var hours = parseInt(hoursMinutes[0], 10);\n    var minutes = hoursMinutes[1] ? parseInt(hoursMinutes[1], 10) : 0;\n    return hours + minutes / 60;\n  };\n\n  const saveEmployees = scheduledEmployees => {\n    scheduledEmployees.forEach(employee => {\n      dispatch(editEmployee(employee._id, employee));\n    });\n  };\n\n  const eraseSchedules = employees => {\n    let blankEmployees = [];\n    employees.forEach(employee => {\n      let tempEmployee = { ...employee,\n        weekSchedule: [],\n        numHours: 0\n      };\n      blankEmployees.push(tempEmployee);\n    });\n    return blankEmployees;\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    let randomShiftsArray = randomizeShifts(shifts);\n    createSchedule(randomShiftsArray);\n    console.log(scheduledEmployees);\n    console.log(excessShifts); // setScheduleStack([...scheduleStack, scheduledEmployees] )\n\n    saveEmployees(scheduledEmployees);\n    setPage(1);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Grid, {\n    container: true,\n    direction: \"column\",\n    justify: \"center\",\n    alignItems: \"center\",\n    children: /*#__PURE__*/_jsxDEV(Button, {\n      style: {\n        color: theme.palette.primary.main,\n        backgroundColor: theme.palette.background.paper,\n        width: 250,\n        height: 50,\n        marginTop: 45,\n        marginBottom: 20\n      },\n      variant: \"contained\",\n      onClick: handleSubmit,\n      children: \"Generate Schedule\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 207,\n    columnNumber: 9\n  }, this);\n};\n\n_s(GenerateScheduleButton, \"x11EswSBhmOdvfSgt30v5mLD3JU=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\n_c = GenerateScheduleButton;\nexport default GenerateScheduleButton;\n\nvar _c;\n\n$RefreshReg$(_c, \"GenerateScheduleButton\");","map":{"version":3,"sources":["/Users/tyler/Documents/Programming/ReactApps/scheduler-app-database/client/src/components/homePage/generateScheduleButton/GenerateScheduleButton.js"],"names":["Button","Typography","Grid","useState","useEffect","useDispatch","useSelector","editEmployee","getEmployees","weekShifts","theme","GenerateScheduleButton","setPage","shifts","dispatch","employees","state","scheduledEmployees","excessShifts","employee","setEmployee","schedule","setSchedule","scheduleStack","setScheduleStack","currentId","setCurrentId","NOON","randomizeShifts","array","shuffledArray","shift","i","length","j","Math","floor","random","x","y","push","randomizeEmployees","createSchedule","dayOff","blankEmployees","eraseSchedules","forEach","randomDay","randomShift","currentEmployee","currentDayOff","currentEmployeeId","_id","isEmployeeAvailable","canEmployeeTakeShift","numHours","desiredHours","replace","slice","weekSchedule","calculateNumHours","splice","some","date","Date","startDate","dayOfWeek","getDay","shiftStartTime","convertTimeToNumber","split","day","availabilityDay","isAvailableMorning","availability","morning","isAvailableEvening","evening","isMorningShift","isAlreadyWorking","checkIfWorking","isTrained","checkIfTrained","numShiftsInDay","includes","employeeShift","find","employeeShiftTime","startTime","endTime","endDate","shiftHours","position","title","positions","pos","trim","time","hoursMinutes","hours","parseInt","minutes","saveEmployees","tempEmployee","handleSubmit","e","preventDefault","randomShiftsArray","console","log","color","palette","primary","main","backgroundColor","background","paper","width","height","marginTop","marginBottom"],"mappings":"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","sourcesContent":["import { Button, Typography, Grid } from \"@material-ui/core\"\nimport { useState, useEffect } from \"react\"\nimport { useDispatch, useSelector } from \"react-redux\"\nimport { editEmployee, getEmployees } from '../../../actions/employees'\nimport weekShifts from '../../../testData/weekShifts'\nimport theme from '../../../themes/mintTheme'\n\n\nconst GenerateScheduleButton = ({setPage}) => {\n    let shifts = weekShifts\n    const dispatch = useDispatch()\n    const employees = useSelector((state) => state.employees)\n    let scheduledEmployees = []\n    let excessShifts = []\n    const [employee, setEmployee] = useState(null)\n    const [schedule, setSchedule] = useState(null)\n    const [scheduleStack, setScheduleStack] = useState([])\n    const [currentId, setCurrentId] = useState(null)\n    const NOON = 12\n\n\n    const randomizeShifts = (array) => {\n        let shuffledArray = []\n\n        let shift = null\n\n        for (let i = array.length - 1; i >= 0; i--) {\n            const j = Math.floor(Math.random() * (i + 1));\n            [array[i], array[j]] = [array[j], array[i]];\n            shift = array[i]\n\n            for (let x = shift.length - 1; x >= 0; x--) {\n                const y = Math.floor(Math.random() * (x + 1));\n                [array[i][x], array[i][y]] = [array[i][y], array[i][x]];\n                shift = array[i][x]\n                shuffledArray.push(shift)\n            }\n        }\n        return shuffledArray\n    }\n\n\n    const randomizeEmployees = (array) => {\n        for (let i = array.length - 1; i >= 0; i--) {\n            const j = Math.floor(Math.random() * (i + 1));\n            [array[i], array[j]] = [array[j], array[i]];\n        }\n    }\n\n\n    const createSchedule = (shifts) => {\n        let i = 0\n        let dayOff = []\n        scheduledEmployees = []\n        excessShifts = []\n        let blankEmployees = eraseSchedules(employees)\n        randomizeEmployees(blankEmployees)\n\n        blankEmployees.forEach((employee) => {\n            let randomDay = Math.floor(Math.random() * 7)\n            dayOff.push(randomDay)\n        })\n        \n        while(shifts.length > 0) {\n            let randomShift = Math.floor(Math.random() * shifts.length)\n            let shift = shifts[randomShift]\n\n            let currentEmployee = blankEmployees[i]\n            let currentDayOff = dayOff[i]\n            let currentEmployeeId = currentEmployee._id\n            \n            const isEmployeeAvailable = canEmployeeTakeShift(currentEmployee, shift, currentDayOff)\n\n            if(isEmployeeAvailable && \n                (currentEmployee.numHours <= currentEmployee.desiredHours.replace(/\\D/g, \"\").slice(-2) ||\n                currentEmployee.desiredHours.replace(/\\D/g, \"\").slice(-2) >= 40)) \n                {\n                    currentEmployee.weekSchedule.push(shift)\n                    calculateNumHours(currentEmployee, shift)\n                    shifts.splice(randomShift,1)\n\n                    if(!scheduledEmployees.some((employee) => employee._id === currentEmployeeId)){\n                        scheduledEmployees.push(currentEmployee)\n                    }\n\n            }\n            else {\n                if (i < blankEmployees.length - 1) {\n                    i++\n                }\n                else {\n                    i=0\n                    excessShifts.push(shift)\n                    shifts.splice(randomShift,1)\n                }\n            }\n\n        }\n    }\n\n\n    const canEmployeeTakeShift = (employee, shift, currentDayOff) => {\n        const date = new Date(shift.startDate)\n        const dayOfWeek = date.getDay()\n        const shiftStartTime = convertTimeToNumber(shift.startDate.split(' ').[4])\n        const day = shift.startDate.split(' ').[0]\n        const availabilityDay = dayOfWeek === 0 ? 6 : dayOfWeek - 1\n        const isAvailableMorning = employee.availability[availabilityDay].morning\n        const isAvailableEvening = employee.availability[availabilityDay].evening\n        const isMorningShift = shiftStartTime < NOON ? true : false\n        const isAlreadyWorking = checkIfWorking(employee, day, isMorningShift)\n        const isTrained = checkIfTrained(employee, shift)\n\n        return isAlreadyWorking ? false\n                : !isTrained ? false\n                : dayOfWeek == currentDayOff ? false\n                : isMorningShift && isAvailableMorning ? true\n                : !isMorningShift && isAvailableEvening ? true\n                : false\n    }\n\n\n    const checkIfWorking = (employee, day, isMorningShift) => {\n        let numShiftsInDay = 0\n        employee.weekSchedule.forEach((shift) => {\n            if( shift.startDate.includes(day) ) {\n                numShiftsInDay++\n            }\n        })\n        if( numShiftsInDay > 1 ) return true\n        \n        const employeeShift = employee.weekSchedule.find( shift => shift.startDate.includes(day) )\n\n        if ( employeeShift ) {\n            const employeeShiftTime = convertTimeToNumber( employeeShift.startDate.split(' ').[4] )\n\n            if(isMorningShift && employeeShiftTime < NOON) return true\n            if(isMorningShift && employeeShiftTime > NOON) return false\n            if(!isMorningShift && employeeShiftTime > NOON) return true\n            if(!isMorningShift && employeeShiftTime > NOON) return false\n        }\n\n        return false\n        \n    }\n\n\n    const calculateNumHours = (employee, shift) => {\n        let startTime = convertTimeToNumber(shift.startDate.split(' ').[4])\n        let endTime = convertTimeToNumber(shift.endDate.split(' ').[4])\n        let shiftHours = endTime - startTime\n        employee.numHours += shiftHours\n    }\n\n\n    const checkIfTrained = (employee, shift) => {\n        const position = shift.title\n        let isTrained = false\n\n        employee.positions.forEach((pos) => {\n            if(position.trim()===pos.trim()) {\n                isTrained = true\n            }\n        })\n        return isTrained\n    }\n\n\n    const convertTimeToNumber = (time) => {\n        var hoursMinutes = time.split(/[.:]/);\n        var hours = parseInt(hoursMinutes[0], 10);\n        var minutes = hoursMinutes[1] ? parseInt(hoursMinutes[1], 10) : 0;\n        return hours + minutes / 60;\n    }\n\n\n    const saveEmployees = ( scheduledEmployees ) => {\n        scheduledEmployees.forEach(( employee ) => {\n            dispatch( editEmployee( employee._id, employee ))\n        })\n    }\n\n\n    const eraseSchedules = (employees) => {\n        let blankEmployees = []\n        employees.forEach((employee) => {\n            let tempEmployee = {...employee, weekSchedule:[], numHours: 0}\n            blankEmployees.push(tempEmployee)\n        })\n        return blankEmployees\n    }\n\n\n    const handleSubmit = (e) => {\n        e.preventDefault()\n        let randomShiftsArray = randomizeShifts(shifts)\n        createSchedule(randomShiftsArray)\n        console.log(scheduledEmployees)\n        console.log(excessShifts)\n        // setScheduleStack([...scheduleStack, scheduledEmployees] )\n        saveEmployees( scheduledEmployees )\n        setPage(1) \n    }\n\n    \n    return (\n        <Grid container direction='column' justify='center' alignItems='center'>\n            <Button style={{ color:theme.palette.primary.main, backgroundColor:theme.palette.background.paper, width: 250, height: 50, marginTop:45, marginBottom:20}} variant='contained' onClick={ handleSubmit }>\n                Generate Schedule\n            </Button>\n        </Grid>\n    )\n}\n\nexport default GenerateScheduleButton\n"]},"metadata":{},"sourceType":"module"}